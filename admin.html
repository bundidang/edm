<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - User & SMTP Management</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #ff8c00; 
            --background-color: #f7f9fc;
            --text-color: #333;
            --border-color: #e0e6ed;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--background-color);
            margin: 0;
            line-height: 1.6;
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 600;
            color: #777;
            transition: color 0.3s, border-bottom 0.3s;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 10px 0;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="email"], input[type="password"], input[type="text"], button, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #e67e00; 
        }

        .message {
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: 600;
            display: none;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* User List Styles */
        #user-list-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #user-list-table th, #user-list-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        #user-list-table th {
            background-color: #f0f3f7;
            font-weight: 700;
            color: var(--text-color);
        }

        #user-list-table tr:nth-child(even) {
            background-color: #fcfdff;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-buttons button {
            width: auto;
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .delete-btn {
            background-color: #dc3545;
        }
        
        .delete-btn:hover {
            background-color: #c82333;
        }

        .status-display {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            background-color: #f0f8ff;
            border-left: 5px solid var(--primary-color);
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Admin Console</h1>
        <p>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('user-management')"><i class="fas fa-users"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
            <button class="tab-button" onclick="openTab('smtp-config')"><i class="fas fa-envelope-open-text"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gmail SMTP</button>
        </div>

        <div id="user-management" class="tab-content active">
            <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <div id="user-list">
                </div>

            <hr style="margin: 20px 0;">

            <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
            <form id="user-form">
                <input type="hidden" id="user-id">
                <div class="form-group">
                    <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username):</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password):</label>
                    <input type="password" id="password" required>
                </div>
                <div class="form-group">
                    <label for="role">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role):</label>
                    <select id="role" required>
                        <option value="admin">Admin</option>
                        <option value="editor">Editor</option>
                        <option value="viewer">Viewer</option>
                    </select>
                </div>
                <button type="submit" id="submit-user-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                <div id="user-message" class="message"></div>
            </form>
        </div>

        <div id="smtp-config" class="tab-content">
            <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gmail SMTP ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á EDMs</h2>
            <p>‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ **‡∏≠‡∏µ‡πÄ‡∏°‡∏• Gmail** ‡πÅ‡∏•‡∏∞ **App Password (16 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)** ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Gmail ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
            
            <div class="status-display">
                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="current-email-display">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...</span>
            </div>

            <form id="smtp-form" style="margin-top: 20px;">
                <div class="form-group">
                    <label for="gmail-email">Gmail Email Address:</label>
                    <input type="email" id="gmail-email" placeholder="example@gmail.com" required>
                </div>
                <div class="form-group">
                    <label for="app-password">App Password (16 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):</label>
                    <input type="password" id="app-password" placeholder="xxxx xxxx xxxx xxxx" required maxlength="16">
                </div>
                <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SMTP</button>
                <div id="smtp-message" class="message"></div>
            </form>
        </div>
    </div>

    <script>
        // ----------------------------------------------------------------------
        // üö® ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Backend API URL ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô Fetch API
        // ----------------------------------------------------------------------
        const BACKEND_API_URL = 'https://script.google.com/macros/s/AKfycbxhpZHtF1nm2uSxutg0GzvN8RQijRLd2I0ggW8-gUwRrurAuGyggm_7jEZMqWQpXsP1/exec';

        /**
         * 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SMTP ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Apps Script Backend
         * (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ localStorage)
         */
        async function saveSmtpConfig(config) {
            try {
                const response = await fetch(BACKEND_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'saveSmtpConfig', // Apps Script ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö action ‡∏ô‡∏µ‡πâ
                        email: config.email,
                        appPassword: config.appPassword
                    })
                });

                const result = await response.json();
                return result; // ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: { success: true/false, message: '...' }

            } catch (error) {
                console.error('Error saving SMTP config:', error);
                return { success: false, message: `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå: ${error.message}` };
            }
        }

        /**
         * 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Apps Script Backend
         * (‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á)
         */
        async function loadSmtpConfig() {
            const displayElement = document.getElementById('current-email-display');
            displayElement.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...';

            try {
                const response = await fetch(BACKEND_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'loadSmtpConfig' }) // Apps Script ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö action ‡∏ô‡∏µ‡πâ
                });

                const result = await response.json();

                if (result.success && result.email) {
                    displayElement.textContent = `‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß: ${result.email}`;
                } else {
                    displayElement.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤';
                }
            } catch (error) {
                console.error('Error loading SMTP config status:', error);
                displayElement.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ (Backend Error)';
            }
        }
        
        // ----------------------------------------------------------------------
        // ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SMTP (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô async ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Backend)
        // ----------------------------------------------------------------------
        document.getElementById('smtp-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('gmail-email').value.trim();
            const appPassword = document.getElementById('app-password').value.trim();
            const messageElement = document.getElementById('smtp-message');

            messageElement.style.display = 'none';

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß App Password (16 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
            if (appPassword.length !== 16) { 
                 messageElement.textContent = '‚ùå App Password ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 16 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏û‡∏≠‡∏î‡∏µ (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Gmail ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)';
                messageElement.className = 'message error';
                messageElement.style.display = 'block';
                return;
            }
            
            const smtpConfig = {
                email: email,   
                appPassword: appPassword 
            };

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Backend
            const result = await saveSmtpConfig(smtpConfig);

            messageElement.textContent = result.message;
            messageElement.className = result.success ? 'message success' : 'message error';
            messageElement.style.display = 'block';

            // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            document.getElementById('app-password').value = ''; 

            // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            if (result.success) {
                loadSmtpConfig();
            }
        });


        // ----------------------------------------------------------------------
        // ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Tabs ‡πÅ‡∏•‡∏∞ User Management (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà User/Pass ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Backend ‡∏à‡∏£‡∏¥‡∏á)
        // ----------------------------------------------------------------------
        function openTab(tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove('active');
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).style.display = "block";
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add("active");
        }

        // Mock data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User Management (‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Backend ‡∏à‡∏£‡∏¥‡∏á)
        let users = JSON.parse(localStorage.getItem('userList')) || [
            { id: 1, username: 'admin', role: 'admin' },
            { id: 2, username: 'user1', role: 'editor' }
        ];
        let nextUserId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;

        function saveUsers() {
            // üí° ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á: ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á users ‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà Backend Server
            localStorage.setItem('userList', JSON.stringify(users));
        }

        function renderUserList() {
            const listElement = document.getElementById('user-list');
            let html = '<table id="user-list-table"><thead><tr><th>ID</th><th>Username</th><th>Role</th><th>Actions</th></tr></thead><tbody>';
            
            users.forEach(user => {
                html += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.role}</td>
                        <td class="action-buttons">
                            <button onclick="editUser(${user.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button class="delete-btn" onclick="deleteUser(${user.id})">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            listElement.innerHTML = html;
        }

        function addUser(username, password, role) {
            const newUser = { id: nextUserId++, username, password, role };
            users.push(newUser);
            saveUsers();
            renderUserList();
            document.getElementById('user-message').textContent = `‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${username} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
            document.getElementById('user-message').className = 'message success';
            document.getElementById('user-message').style.display = 'block';
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                document.getElementById('user-id').value = user.id;
                document.getElementById('username').value = user.username;
                // ‡πÑ‡∏°‡πà‡∏î‡∏∂‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                document.getElementById('password').value = ''; 
                document.getElementById('password').required = false; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                document.getElementById('role').value = user.role;
                document.getElementById('submit-user-btn').textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
            }
        }

        function updateUser(id, username, password, role) {
            const index = users.findIndex(u => u.id === id);
            if (index !== -1) {
                users[index].username = username;
                users[index].role = role;
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                if (password) {
                    users[index].password = password;
                }
                saveUsers();
                renderUserList();
                resetUserForm();
                document.getElementById('user-message').textContent = `‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${username} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
                document.getElementById('user-message').className = 'message success';
                document.getElementById('user-message').style.display = 'block';
            }
        }

        function deleteUser(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?')) {
                users = users.filter(u => u.id !== id);
                saveUsers();
                renderUserList();
                document.getElementById('user-message').textContent = `‚úÖ ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
                document.getElementById('user-message').className = 'message success';
                document.getElementById('user-message').style.display = 'block';
            }
        }

        function resetUserForm() {
            document.getElementById('user-id').value = '';
            document.getElementById('user-form').reset();
            document.getElementById('password').required = true;
            document.getElementById('submit-user-btn').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
        }

        document.getElementById('user-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('user-id').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            if (id) {
                updateUser(parseInt(id), username, password, role);
            } else {
                addUser(username, password, role);
            }
        });


        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞ config ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        document.addEventListener('DOMContentLoaded', () => {
             // üí° ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö User Management ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
             renderUserList(); 
             // üí° ‡πÇ‡∏´‡∏•‡∏î config SMTP ‡∏à‡∏≤‡∏Å Backend
             loadSmtpConfig();
        });
    </script>
</body>
</html>
